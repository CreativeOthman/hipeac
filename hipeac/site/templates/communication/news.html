{% extends 'layout.html' %}

{% load compress %}
{% load staticfiles %}


{% block head_title %}News - {{ block.super }}{% endblock %}

{% block subtitle %}{{ flatpage.title }}{% endblock %}

{% block submenu %}
    <li class="nav-item">
        <router-link :to="{name: 'news'}" class="nav-link" exact>News</router-link>
    </li>
    <li class="nav-item">
        <router-link :to="{name: 'magazine'}" class="nav-link">Magazine</router-link>
    </li>
    <li class="nav-item">
        <router-link :to="{name: 'blog'}" class="nav-link">Blog</router-link>
    </li>
    <li class="nav-item">
        <router-link :to="{name: 'roadshow'}" class="nav-link">Roadshow</router-link>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="https://twitter.com/hipeac" target="_blank"><span is="twitter-icon"></span></a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="https://www.hipeac.net/linkedin/" target="_blank"><span is="linkedin-icon"></span></a>
    </li>
{% endblock %}

{% block content %}
    <div id="urls" data-event-list="{% url 'v1:event-list' %}" class="container">
        <router-view></router-view>
    </div>
{% endblock %}

{% block vue_templates %}
    {% include './v-magazine.html' with id='v-blog' blck=flatpage.page.tbs.magazine %}
    {% include './v-magazine.html' with id='v-magazine' blck=flatpage.page.tbs.magazine %}
    {% include './v-magazine.html' with id='v-news' blck=flatpage.page.tbs.magazine %}
    {% include './v-roadshow.html' with id='v-roadshow' blck=flatpage.page.tbs.roadshow %}
{% endblock %}

{% block scripts %}
{% compress js inline %}
    <script>
        var Store = new Vuex.Store({
            state: {
                news: []
            },
            mutations: {
                fetchNews: function (state) {
                    ajax().get($('#urls').data('job-list')).done(function (res) {
                        state.news = res;
                    });
                }
            }
        });

        var BlogView = {
            template: '#v-blog',
            computed: _.extend(
                Vuex.mapState(['news']), {
            })
        };

        var MagazineView = {
            template: '#v-magazine',
            computed: _.extend(
                Vuex.mapState(['news']), {
            })
        };

        var NewsView = {
            template: '#v-news',
            computed: _.extend(
                Vuex.mapState(['news']), {
            })
        };

        var RoadshowView = {
            template: '#v-roadshow',
            computed: _.extend(
                Vuex.mapState(['news']), {
            })
        };

        var Router = new VueRouter({
            linkActiveClass: 'active',
            routes: [
                {
                    name: 'blog',
                    path: '/blog/',
                    pathToRegexpOptions: {strict: true},
                    component: BlogView
                },
                {
                    name: 'magazine',
                    path: '/magazine/',
                    pathToRegexpOptions: {strict: true},
                    component: MagazineView
                },
                {
                    name: 'news',
                    path: '/',
                    pathToRegexpOptions: {strict: true},
                    component: NewsView
                },
                {
                    name: 'roadshow',
                    path: '/roadshow/',
                    pathToRegexpOptions: {strict: true},
                    component: RoadshowView
                }
            ]
        });

        var app = new Vue({
            el: '#vue',
            store: Store,
            router: Router,
            created: function () {
                $.when(
                    this.$store.commit('fetchNews')
                );
            }
        });
    </script>
{% endcompress %}
{% endblock %}
